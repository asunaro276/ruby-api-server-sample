# 投稿機能 仕様

## ADDED Requirements

### Requirement: 投稿作成
システムは認証済みユーザーが新しい投稿を作成する機能を提供するものとします（SHALL provide post creation）。

#### Scenario: テキストのみの投稿作成
- **WHEN** 認証済みユーザーが `POST /api/v1/posts` に有効な投稿内容（content）を送信
- **THEN** 新しい投稿が作成され、投稿情報が返される
- **AND** ステータスコード 201 (Created) が返される
- **AND** 投稿内容は最大280文字まで許可される

#### Scenario: 画像付き投稿作成
- **WHEN** 認証済みユーザーが投稿内容と画像ファイルを送信
- **THEN** 画像が外部ストレージ（S3）にアップロードされる
- **AND** 投稿が画像URLと共に作成される
- **AND** ステータスコード 201 (Created) が返される

#### Scenario: 認証なしで投稿作成
- **WHEN** 未認証のユーザーが投稿作成を試みる
- **THEN** 認証エラーメッセージが返される
- **AND** ステータスコード 401 (Unauthorized) が返される

#### Scenario: 空の投稿内容で作成
- **WHEN** 認証済みユーザーが空の投稿内容を送信
- **THEN** バリデーションエラーが返される
- **AND** エラーメッセージに「投稿内容を入力してください」と表示される
- **AND** ステータスコード 422 (Unprocessable Entity) が返される

#### Scenario: 280文字を超える投稿内容で作成
- **WHEN** 認証済みユーザーが280文字を超える投稿内容を送信
- **THEN** バリデーションエラーが返される
- **AND** エラーメッセージに「投稿内容は280文字以内である必要があります」と表示される
- **AND** ステータスコード 422 (Unprocessable Entity) が返される

### Requirement: 投稿一覧取得
システムは投稿の一覧を取得する機能を提供するものとします（SHALL provide post listing）。

#### Scenario: 投稿一覧を取得
- **WHEN** クライアントが `GET /api/v1/posts` にリクエストを送信
- **THEN** 投稿一覧が新しい順に返される
- **AND** 各投稿には作成者情報、いいね数、コメント数が含まれる
- **AND** ステータスコード 200 (OK) が返される

#### Scenario: ページネーション付きで投稿一覧を取得
- **WHEN** クライアントがページ番号とページサイズをクエリパラメータで指定
- **THEN** 指定されたページの投稿一覧が返される
- **AND** ページネーション情報（総ページ数、現在のページなど）が含まれる
- **AND** ステータスコード 200 (OK) が返される

### Requirement: 投稿詳細取得
システムは特定の投稿の詳細情報を取得する機能を提供するものとします（SHALL provide post details）。

#### Scenario: 存在する投稿の詳細取得
- **WHEN** クライアントが `GET /api/v1/posts/:id` にリクエストを送信
- **THEN** 指定された投稿の詳細情報が返される
- **AND** 投稿には作成者情報、いいね数、コメント数、画像URLが含まれる
- **AND** ステータスコード 200 (OK) が返される

#### Scenario: 存在しない投稿の詳細取得
- **WHEN** クライアントが存在しない投稿IDで詳細取得を試みる
- **THEN** エラーメッセージが返される
- **AND** ステータスコード 404 (Not Found) が返される

### Requirement: 投稿更新
システムは認証済みユーザーが自分の投稿を更新する機能を提供するものとします（SHALL provide post update）。

#### Scenario: 自分の投稿を更新
- **WHEN** 認証済みユーザーが `PUT /api/v1/posts/:id` に更新内容を送信
- **THEN** 投稿内容が更新される
- **AND** 更新された投稿情報が返される
- **AND** ステータスコード 200 (OK) が返される

#### Scenario: 他人の投稿を更新
- **WHEN** 認証済みユーザーが他のユーザーの投稿を更新しようとする
- **THEN** 権限エラーメッセージが返される
- **AND** ステータスコード 403 (Forbidden) が返される

#### Scenario: 認証なしで投稿を更新
- **WHEN** 未認証のユーザーが投稿更新を試みる
- **THEN** 認証エラーメッセージが返される
- **AND** ステータスコード 401 (Unauthorized) が返される

### Requirement: 投稿削除
システムは認証済みユーザーが自分の投稿を削除する機能を提供するものとします（SHALL provide post deletion）。

#### Scenario: 自分の投稿を削除
- **WHEN** 認証済みユーザーが `DELETE /api/v1/posts/:id` にリクエストを送信
- **THEN** 投稿が削除される
- **AND** 削除成功メッセージが返される
- **AND** ステータスコード 200 (OK) が返される
- **AND** 関連するいいねとコメントも削除される

#### Scenario: 他人の投稿を削除
- **WHEN** 認証済みユーザーが他のユーザーの投稿を削除しようとする
- **THEN** 権限エラーメッセージが返される
- **AND** ステータスコード 403 (Forbidden) が返される

#### Scenario: 認証なしで投稿を削除
- **WHEN** 未認証のユーザーが投稿削除を試みる
- **THEN** 認証エラーメッセージが返される
- **AND** ステータスコード 401 (Unauthorized) が返される

### Requirement: 画像アップロード
システムは投稿への画像添付機能を提供するものとします（SHALL provide image upload）。

#### Scenario: 有効な画像をアップロード
- **WHEN** 認証済みユーザーが有効な画像ファイル（JPEG, PNG, GIF）をアップロード
- **THEN** 画像が外部ストレージ（S3）にアップロードされる
- **AND** 画像URLが投稿に関連付けられる
- **AND** ステータスコード 201 (Created) が返される

#### Scenario: 無効な形式の画像をアップロード
- **WHEN** 認証済みユーザーが無効な形式のファイル（例: PDF, EXE）をアップロード
- **THEN** バリデーションエラーが返される
- **AND** エラーメッセージに「サポートされていない画像形式です」と表示される
- **AND** ステータスコード 422 (Unprocessable Entity) が返される

#### Scenario: サイズ制限を超える画像をアップロード
- **WHEN** 認証済みユーザーが10MBを超える画像をアップロード
- **THEN** バリデーションエラーが返される
- **AND** エラーメッセージに「画像サイズは10MB以下である必要があります」と表示される
- **AND** ステータスコード 422 (Unprocessable Entity) が返される

### Requirement: ユーザー別投稿一覧取得
システムは特定のユーザーの投稿一覧を取得する機能を提供するものとします（SHALL provide user-specific post listing）。

#### Scenario: 特定ユーザーの投稿一覧を取得
- **WHEN** クライアントが `GET /api/v1/users/:user_id/posts` にリクエストを送信
- **THEN** 指定されたユーザーの投稿一覧が新しい順に返される
- **AND** ステータスコード 200 (OK) が返される
